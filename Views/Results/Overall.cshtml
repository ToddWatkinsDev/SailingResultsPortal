@{
    ViewData["Title"] = "Overall Results";
    var eventId = ViewData["EventId"] as string ?? "";
    var ev = ViewData["Event"] as SailingResultsPortal.Models.Event;
    var overallPoints = ViewData["OverallPoints"] as Dictionary<string, (int TotalPoints, List<(string RaceName, int Points)> RaceDetails)> ?? new Dictionary<string, (int, List<(string, int)>)>();
}

<nav class="text-sm text-gray-600 mb-4" aria-label="Breadcrumb">
    <ol class="list-reset flex">
        <li><a href="/" class="hover:underline">Home</a></li>
        <li><span class="mx-2">/</span></li>
        <li><a href="/Results/Public" class="hover:underline">Events</a></li>
        <li><span class="mx-2">/</span></li>
        <li><a href="/Results/Public?eventId=@eventId" class="hover:underline">@ev?.Name</a></li>
        <li><span class="mx-2">/</span></li>
        <li>Overall Results</li>
    </ol>
</nav>

<h1 class="text-2xl font-bold mb-4">@ev?.Name - Overall Results</h1>

@if (overallPoints.Any())
{
    <div class="mb-4">
        <a href="/Results/Public?eventId=@eventId" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-2">View Race Results</a>
        <a href="/Results/ExportCsv?eventId=@eventId" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mr-2">Export CSV</a>
        <a href="/Results/ExportJson?eventId=@eventId" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Export JSON</a>
    </div>

    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sailor</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Points</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Race Details</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @foreach (var (sailor, position) in overallPoints.Select((kvp, i) => (kvp.Key, i + 1)))
                {
                    var (totalPoints, raceDetails) = overallPoints[sailor];
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">@position</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@sailor</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">@totalPoints</td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            @foreach (var (raceName, points) in raceDetails.OrderBy(r => r.RaceName))
                            {
                                <span class="inline-block bg-gray-100 rounded px-2 py-1 text-xs mr-1 mb-1">
                                    @raceName: @points pts
                                </span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mt-6 bg-blue-50 p-4 rounded">
        <h3 class="text-lg font-semibold text-blue-800 mb-2">Scoring Information</h3>
        <ul class="text-sm text-blue-700 space-y-1">
            <li>• Lower total points = better overall position</li>
            <li>• Points are calculated based on finish position in each race</li>
            <li>• Medal races count double points</li>
            <li>• DNS/DNC/DNF/RET receive penalty points</li>
        </ul>
    </div>
}
else
{
    <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
        <div class="flex">
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    No results available for this event yet.
                    <a href="/Results/Public?eventId=@eventId" class="font-medium underline text-yellow-700 hover:text-yellow-600">
                        View individual race results
                    </a>
                </p>
            </div>
        </div>
    </div>
}